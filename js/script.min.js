class SpriteCover{constructor(spriteElement,container,frameWidth,frameHeight,frameCount){this.sprite=spriteElement;this.container=container;this.frameWidth=frameWidth;this.frameHeight=frameHeight;this.currentFrame=0;this.totalFrames=frameCount;this.scale=1;this.xCenter=0;this.yCenter=0;this.resizeObserver=new ResizeObserver(()=>this.updateSize());this.resizeObserver.observe(container);this.initSprite();this.updateSize();}
destroy(){this.resizeObserver.disconnect();}
initSprite(){this.sprite.parentElement.parentElement.style.width=`${this.frameWidth * this.totalFrames}px`;this.sprite.parentElement.parentElement.style.height=`${this.frameHeight}px`;}
updateSize(){const containerWidth=Math.abs(this.container.clientWidth);const containerHeight=Math.abs(this.container.clientHeight);if(containerWidth>containerHeight){this.scale=containerWidth/this.frameWidth;console.log("containerWidth =",containerWidth,"this.frameWidth= ",this.frameWidth);this.yCenter=-this.frameHeight*(((containerWidth-containerHeight)/2)/containerWidth);this.xCenter=0;}
else if(containerHeight>containerWidth){this.scale=containerHeight/this.frameHeight;console.log("containerHeight =",containerHeight,"this.frameHeight= ",this.frameHeight);this.xCenter=-this.frameWidth*(((containerHeight-containerWidth)/2)/containerHeight);this.yCenter=0;}
else{this.scale=containerHeight/this.frameHeight;this.xCenter=0;this.yCenter=0;}
this.sprite.parentElement.parentElement.style.transform=`scale(${this.scale})`;this.updateTransform();}
updateTransform(){const xOffset=-this.currentFrame*this.frameWidth+this.xCenter;this.sprite.style.transform=`translateX(${xOffset}px) translateY(${this.yCenter}px)`;}
setFrame(index){this.currentFrame=index;this.updateTransform();}}
const textTimeline=[{time:0,text:"Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ Ð¿Ð¾Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ñ Ð°ÐºÐ²Ð°Ð»Ð°Ð½Ð³Ð¾Ð¼ Ð² ÐšÑ€Ð°ÑÐ½Ð¾Ð¼ Ð¼Ð¾Ñ€Ðµ"},{time:0.99,text:"Ñ€Ð¾Ð¼Ð°Ð½Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ ÑƒÐ¶Ð¸Ð½Ð° Ð½Ð° Ð¿Ð»ÑÐ¶Ðµ ÐœÐ°Ð»ÑŒÐ´Ð¸Ð²"},{time:1.88,text:"Ð¿Ð¾Ð»ÐµÑ‚Ð° Ð½Ð° Ð²Ð¾Ð·Ð´ÑƒÑˆÐ½Ð¾Ð¼ ÑˆÐ°Ñ€Ðµ Ð½Ð°Ð´ ÐšÐ°Ð¿Ð¿Ð°Ð´Ð¾ÐºÐ¸ÐµÐ¹"},{time:2.66,text:"ÐºÑƒÐ¿Ð°Ð½Ð¸Ñ ÑÐ¾ ÑÐ»Ð¾Ð½Ð°Ð¼Ð¸ Ð² Ð¢Ð°Ð¸Ð»Ð°Ð½Ð´Ðµ"},{time:3.38,text:"Ð·Ð°Ð²Ñ‚Ñ€Ð°ÐºÐ° Ð² Ð±Ð°ÑÑÐµÐ¹Ð½Ðµ Ð½Ð° Ð²Ð¸Ð»Ð»Ðµ Ð² Ð”ÑƒÐ±Ð°Ðµ"},{time:4.04,text:"Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ ÑƒÑ€Ð¾ÐºÐ° ÑÐµÑ€Ñ„Ð¸Ð½Ð³Ð° Ð½Ð° Ð‘Ð°Ð»Ð¸"},{time:4.67,text:"Ð¿Ñ€Ð¾Ð³ÑƒÐ»ÐºÐ¸ Ð½Ð° ÑÑ…Ñ‚Ðµ Ð¿Ð¾ Ð¿Ð¾Ð±ÐµÑ€ÐµÐ¶ÑŒÑŽ Ð”ÑƒÐ±Ð°Ñ"},{time:5.29,text:"Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ Ð·Ð°Ð¿Ð»Ñ‹Ð²Ð° Ñ Ñ‡ÐµÑ€ÐµÐ¿Ð°Ñ…Ð°Ð¼Ð¸ Ð½Ð° ÐœÐ°Ð»ÑŒÐ´Ð¸Ð²Ð°Ñ…"},{time:5.91,text:"Ð¿Ð¾ÑÐµÑ‰ÐµÐ½Ð¸Ñ Ñ‚ÐµÑ€Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¸ÑÑ‚Ð¾Ñ‡Ð½Ð¸ÐºÐ¾Ð² ÐŸÐ°Ð¼ÑƒÐºÐºÐ°Ð»Ðµ"},{time:6.55,text:"Ð´ÐµÐ³ÑƒÑÑ‚Ð°Ñ†Ð¸Ð¸ Ð¼ÐµÑÑ‚Ð½Ð¾Ð¹ ÐºÑƒÑ…Ð½Ð¸ Ð² Ð¡Ñ‚Ð°Ð¼Ð±ÑƒÐ»Ðµ"},{time:7.24,text:"Ñ€Ñ‹Ð±Ð°Ð»ÐºÐ¸ Ð½Ð° Ð·Ð°ÐºÐ°Ñ‚Ðµ Ð² Ð˜Ð½Ð´Ð¸Ð¹ÑÐºÐ¾Ð¼ Ð¾ÐºÐµÐ°Ð½Ðµ"},{time:7.98,text:"Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ ÑƒÑ€Ð¾ÐºÐ° Ð´Ð°Ð¹Ð²Ð¸Ð½Ð³Ð° Ð² Ð±Ð°ÑÑÐµÐ¹Ð½Ðµ"},{time:8.82,text:"ÑÐ¿Ð°-Ñ€Ð¸Ñ‚ÑƒÐ°Ð»Ð° Ñ Ð²Ð¸Ð´Ð¾Ð¼ Ð½Ð° Ð¾ÐºÐµÐ°Ð½"},{time:9.75,text:"Ñ…Ð°Ð¼Ð¼Ð°Ð¼Ð° Ð² Ð»ÑƒÑ‡ÑˆÐ¸Ñ… Ñ‚Ñ€Ð°Ð´Ð¸Ñ†Ð¸ÑÑ… Ð¢ÑƒÑ€Ñ†Ð¸Ð¸"},{time:10.8,text:"Ñ‚Ð°Ð¹ÑÐºÐ¾Ð³Ð¾ Ð¼Ð°ÑÑÐ°Ð¶Ð° Ð½Ð° Ð¿Ð»ÑÐ¶Ðµ"},];async function loadInto(){let controller=new AbortController();let{signal}=controller;intro:try{let loadedProgressSteps=0;const allProgressSteps=2;function updateProgress(loadedCount,allCount){setLoadProgress((loadedProgressSteps+loadedCount)*100/(allProgressSteps+allCount))}
console.log("ðŸ”¹ Step 0: get intro show flag");introFlags=await loadStep([checkIntroFlags(),loadCSS("css/bootstrap.element.min.css"),loadScript("https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js")],signal);if(introFlags.includes("returned")){await loadStep([prepareSkipButtons(".slide-container.zero-slide ~ [class*='-slide']",controller),],signal);}
else if(introFlags.includes("skip")){console.log("skipping intro");skipIntro();break intro;}
console.log("ðŸ”¹ Step 2: load zero slide css");await loadStep([loadCSS("css/zero.min.css"),],signal);document.body.style.display='block';console.log("ðŸ”¹ Step 3: load lazy load js");await loadStep([loadScript("https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.min.js","LazyLoad"),],signal);console.log("ðŸ”¹ Step 4: load zero slide resources");await loadStep([loadResources(".slide-container.zero-slide .lazy",null),],signal);loadedProgressSteps++;updateProgress(0,allProgressSteps);console.log("ðŸ”¹ Step 5: load main css");await loadStep([loadCSS("css/style.min.css"),loadScript("https://cdnjs.cloudflare.com/ajax/libs/fitty/2.3.2/fitty.min.js","fitty")],signal);loadedProgressSteps++;updateProgress(0,allProgressSteps);console.log("ðŸ”¹ Step 6: load intro slides resources");const step6Results=await loadStep([loadResources(".slide-container.zero-slide ~ [class*='-slide'] .lazy",updateProgress),loadCSS("css/bootstrap.element.min.css"),loadScript("https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"),initSprite()],signal);console.log("ðŸ”¹ Step 7: waiting resources progress");await loadStep([waitForProgressCompete(),],signal);loadCSS("css/element-icons.min.css");console.log("ðŸ”¹ Step 8: blue part animation");await loadStep([showBluePartAnimation(),],signal);console.log("ðŸ”¹ Step 9: hide zero slide and begin slideshow");await loadStep([removeSlide(document.querySelector(".slide-container.zero-slide")),startSlidesCycle(".slide-container.zero-slide ~ [class*='-slide']",step6Results[3])],signal);}
catch(error){if(error.name==="AbortError"){console.log("â© Loading skipped by user");skipIntro();}else{console.error("âŒ Error loading page:",error);}}
controller=new AbortController();signal=controller.signal;try{console.log("ðŸ”¹ Step 10: loading main page scripts");await loadStep([loadScript("https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.min.js","LazyLoad"),loadCSS("css/bootstrap.element.min.css"),loadScript("https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"),loadScript("https://player.vimeo.com/api/player.js")],signal);console.log("ðŸ”¹ Step 11: loading main page resources");const step11Results=await loadStep([loadCSS("css/style.min.css"),loadResources(".video-banner-poster-lazy"),initLazyLoad(),],signal);window.lazyLoadInstance=step11Results[2];console.log("ðŸ”¹ Step 12: showing page and lazyload remaining resources");const step12Results=await loadStep([enableMainPage(),showMainPage(),loadCSS("css/element-icons.min.css")],signal);}
catch(error){if(error.name==="AbortError"){console.log("â© Loading skipped by user");await showMainPage();}else{console.error("âŒ Error loading page:",error);await showMainPage();}}}
async function loadStep(promises,signal){return new Promise((resolve,reject)=>{if(signal?.aborted){reject(new DOMException("Aborted","AbortError"));return;}
const onAbort=()=>{reject(new DOMException("Aborted","AbortError"));};signal?.addEventListener("abort",onAbort,{once:true});Promise.all(promises.map(p=>p.catch(err=>{console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð² loadStep:",err);throw err;}))).then(resolve).catch(reject).finally(()=>{signal?.removeEventListener("abort",onAbort);});});}
async function loadCSS(href){return new Promise((resolve,reject)=>{if(document.querySelector(`link[href="${href}"]`)){console.log("Loaded css: "+href);return resolve();}
const link=document.createElement("link");link.rel="stylesheet";link.href=href;link.onload=()=>{console.log("Loaded css: "+href);resolve();};link.onerror=reject;document.head.appendChild(link);});}
function loadScript(src,globalVar=null,checkInterval=10,timeout=5000){function loadScriptInternal(src,globalVar=null,checkInterval=10,timeout=5000){return new Promise((resolve,reject)=>{if(document.querySelector(`script[src="${src}"]`)){if(!globalVar||window[globalVar])return resolve(window[globalVar]);}
const script=document.createElement("script");script.src=src;script.onload=()=>{if(!globalVar){console.log("Loaded script: "+src);resolve();return;}
const startTime=Date.now();const checkVar=setInterval(()=>{if(window[globalVar]){clearInterval(checkVar);console.log("Loaded script: "+src);resolve(window[globalVar]);}else if(Date.now()-startTime>timeout){clearInterval(checkVar);reject(new Error(`Timeout: ${globalVar} Ð½Ðµ Ð¿Ð¾ÑÐ²Ð¸Ð»ÑÑ Ð¿Ð¾ÑÐ»Ðµ ${timeout} Ð¼Ñ`));}},checkInterval);};script.onerror=()=>reject(new Error(`ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸: ${src}`));document.head.appendChild(script);});}
return new Promise((resolve,reject)=>{function attempt(remainingAttempts){loadScriptInternal(src).then(resolve).catch((err)=>{if(remainingAttempts>0){setTimeout(()=>attempt(remainingAttempts-1),1000);}else{reject(err);}});}
attempt(3);});}
async function loadResources(selector,updateProgress){console.log("starting loading resources for: ",selector);return new Promise((resolve,reject)=>{let elementsCount=0;const lazyLoad=new LazyLoad({elements_selector:selector,callback_loaded:(elem)=>{if(!elementsCount){elementsCount=lazyLoad.toLoadCount+1;}
if(updateProgress){updateProgress((elementsCount-lazyLoad.toLoadCount),elementsCount);}},callback_finish:(lazyInstance)=>{lazyInstance.destroy();elementsCount=0;if(updateProgress){updateProgress(elementsCount,elementsCount);}
resolve();}});lazyLoad.loadAll();});}
function getLocalStorageValue(key){let value=localStorage.getItem(key)?parseInt(localStorage.getItem(key),10)||0:0;return value;}
function incrementLocalStorageValue(key){let value=getLocalStorageValue(key);localStorage.setItem(key,(value+1).toString());}
async function checkIntroFlags(){return new Promise((resolve,reject)=>{const MAX_SKIP_COUNT=3;let visitCount=getLocalStorageValue('siteVisits');let skipCount=getLocalStorageValue('skipIntro');incrementLocalStorageValue('siteVisits');console.log("visitCount = ",visitCount,"skipCount =",skipCount);if(skipCount>=MAX_SKIP_COUNT){resolve("skip");}else if(visitCount===1){resolve("first_visit");}else{resolve("returned");}});}
async function prepareSkipButtons(slidesSelector,controller){return new Promise((resolve,reject)=>{let slides=document.querySelectorAll(slidesSelector);if(slides){slides.forEach((slide)=>{let skipButton=slide.querySelector('.btn-skip');if(skipButton){skipButton.style.display='block';skipButton.addEventListener('click',()=>{console.log("â© User clicked skip");controller.abort();});}
else{reject("no skip buttons found");}});}
resolve("ok");});}
let currentProgress=0;let animationQueue=[];let isAnimating=false;let startTime=0;function setLoadProgress(targetProgress){if(!startTime){console.error("DOM not loaded");return;}
if(isAnimating){animationQueue.push(targetProgress);return;}
if(targetProgress>0&&targetProgress<101){logo=document.querySelector(".lazy.logo").contentDocument;if(!logo)return;const maskRect=logo.getElementById('maskRect');if(maskRect){const diff=Math.abs(targetProgress-currentProgress);const duration=(diff/100)*1;let elapsedTime=(performance.now()-startTime)/1000;const animateY=createSVGAnimation(maskRect,"animate","animateY","y",`${100 - currentProgress}%`,`${100 - targetProgress}%`,`${duration}s`,`${elapsedTime}s`);const animateHeight=createSVGAnimation(maskRect,"animate","animateHeight","height",`${currentProgress}%`,`${targetProgress}%`,`${duration}s`,`${elapsedTime}s`);console.log(`progress update ${currentProgress} -> ${targetProgress} duration ${duration}`);isAnimating=true;function onAnimationEnd(){isAnimating=false;currentProgress=targetProgress;if(animationQueue.length>0){const nextProgress=animationQueue.shift();if(nextProgress>targetProgress){setLoadProgress(nextProgress);}}
else{animateY.removeEventListener("endEvent",onAnimationEnd);}}
animateY.addEventListener("endEvent",onAnimationEnd);}}}
function waitForProgressCompete(){return new Promise((resolve,reject)=>{function onAnimationEnd(){if(currentProgress>99){resubscribeAllAnimates(true);resolve();}
resubscribeAllAnimates(false);}
logo=document.querySelector(".lazy.logo").contentDocument
function resubscribeAllAnimates(unsubscrubeOnly){animates=logo.querySelectorAll('[id="animateY"]');animates.forEach((animate)=>{animate.removeEventListener("endEvent",onAnimationEnd);if(!unsubscrubeOnly){animate.addEventListener("endEvent",onAnimationEnd);}});}
resubscribeAllAnimates(false);});}
function showBluePartAnimation(){return new Promise((resolve,reject)=>{let elapsedTime=(performance.now()-startTime)/1000;const logoDoc=document.querySelector(".lazy.logo").contentDocument;const bluePath=logoDoc.getElementById("bluePath");createSVGAnimation(bluePath,"animate","bluePathStroke","stroke-dashoffset",`1000`,`0`,`0.7s`,`${elapsedTime}s`,"spline","0.42 0 0.58 1");const blueFill=logoDoc.getElementById("blueFill");createSVGAnimation(blueFill,"animate","blueFillOpacity","fill-opacity",`0`,`1`,`0.3s`,`${elapsedTime + 0.7}s`);const bluePart=logoDoc.getElementById("bluePart");createSVGAnimation(bluePart,"animateTransform","animateScaleUp","transform","1 1","1.1 1.1","0.2s",`${elapsedTime + 1.2}s`,0,0,type="scale");createSVGAnimation(bluePart,"animateTransform","animateScaleDown","transform",`1.1 1.1`,`1 1`,`0.3s`,`${elapsedTime + 1.5}s`,0,0,type="scale");function onAnimationEnd(){resolve();}
const animateScaleDown=logoDoc.getElementById("animateScaleDown");animateScaleDown.addEventListener("endEvent",onAnimationEnd);console.log("waiting for animation of blue part to finish");});}
function createSVGAnimation(parentElement,newElementType,id,attributeName,from,to,duration,begin=0,calcMode=0,keySplines=0,type=0){const animate=document.createElementNS("http://www.w3.org/2000/svg",newElementType);animate.setAttribute("id",id);animate.setAttribute("attributeName",attributeName);if(calcMode){animate.setAttribute("calcMode",calcMode);}
if(keySplines){animate.setAttribute("keySplines",keySplines);}
if(type){animate.setAttribute("type",type);}
animate.setAttribute("from",from);animate.setAttribute("to",to);animate.setAttribute("dur",`${duration}`);animate.setAttribute("begin",`${begin}`);animate.setAttribute("fill","freeze");parentElement.appendChild(animate);return animate;}
function removeSlide(slide){return new Promise((resolve,reject)=>{if(!slide)return;slide.style.display="none";resolve();});}
function skipIntro(){const slides=document.querySelectorAll("body > [class*='-slide']");slides.forEach((slide)=>{removeSlide(slide);});const mainPage=document.querySelector(".main-page");const navbar=document.getElementById("mainNavbar");const roundButton=document.getElementById('round-center-button');const mainpageTextRows=mainPage.querySelectorAll(".text-row");document.body.style.backgroundColor="var(--text-light-color-hover)";incrementLocalStorageValue('skipIntro');if(mainPage){mainPage.style.display='block';mainPage.style.animation='none';mainPage.offsetHeight;mainPage.style.animation='showMainPage 10ms linear forwards, reduceHeightMainPage 10ms ease-out forwards';}
if(navbar){navbar.style.animation='none';navbar.offsetHeight;navbar.style.animation='moveDownNavBar 10ms ease-out 1 normal forwards';}
if(roundButton){roundButton.style.animation='none';roundButton.offsetHeight;roundButton.style.animation='fadeInButton 10ms ease-out 1 normal forwards';}
if(mainpageTextRows){mainpageTextRows.forEach(row=>{row.style.display='none';row.style.animation='none !important';row.style.transition='none !important';});}}
function initSprite(){return new Promise((resolve,reject)=>{const sprite=document.getElementById('sprite');const viewport=document.querySelector('.viewport');const img=document.querySelector('.viewport img');if(sprite.complete){resolve(createSpriteControler(sprite,viewport));}else{img.addEventListener("load",()=>{resolve(createSpriteControler(sprite,viewport));},{once:true});}});function createSpriteControler(sprite,viewport){const controller=new SpriteCover(sprite,viewport,sprite.naturalHeight,sprite.naturalHeight,textTimeline.length);return controller;}}
function startSlidesCycle(slidesSelector,spriteControler){function runSlideshow(){let currentIndex=0;const fourthslideText=document.querySelector('.fourth-slide .text-block h2 span');const fourthSlideTextColumn=document.querySelector('.slide-container.fourth-slide .text-column-fill')
let current=0;function nextFrame(spriteControler){console.log("current =",current);if(spriteControler){if(current>=textTimeline.length){console.log("nextFrame exit");return;}
console.log("current =",current);spriteControler.setFrame(current);current++;if(current<textTimeline.length){let delay=(textTimeline[current].time-textTimeline[current-1].time)*1000;setTimeout(()=>{nextFrame(spriteControler);},delay);}}}
fourthSlideTextColumn.addEventListener('animationend',(event)=>{if(event.animationName==='zoomInText'){nextFrame(spriteControler);}});}
function runIntroSlidesAnimation(){const animElements=document.querySelectorAll(".pending-animation:not(.animation)");animElements.forEach((elem)=>{console.log(`Starting animation for ${elem.classList}`);elem.classList.add("animation");});}
return new Promise((resolve,reject)=>{const slides=document.querySelectorAll(slidesSelector);slidesCount=slides.length;runIntroSlidesAnimation();runSlideshow();let resizeTimeout;window.addEventListener('resize',()=>{clearTimeout(resizeTimeout);resizeTimeout=setTimeout(calcTextRows,100);});calcTextRows();if(slidesCount){slides.forEach((slide)=>{console.log(`subscribing slide for animationend ${slide.classList}`)
slide.addEventListener('animationend',(event)=>{if(event.animationName==='showHideSlide'){console.log(`Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð° Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ñ ÑÐºÑ€Ñ‹Ñ‚Ð¸Ñ ÑÐ»Ð°Ð¹Ð´Ð° ${slide.classList}`);removeSlide(slide);slidesCount--;console.log("slidesCount = ",slidesCount);if(!slidesCount){resolve();}}});});}
else{reject("no intro slides flound");}});}
function fitTextToContainer(containerSelector){const container=document.querySelector(containerSelector);if(!container){return;}
const rows=Array.from(container.querySelectorAll(".text-row"));const containerWidth=container.offsetWidth;const containerHeight=container.offsetHeight;let currentWidth=containerWidth;let lastWidth=currentWidth;let iterations=0;let fittedRows=null;const MAX_ITERATIONS=10;const MIN_WIDTH=100;const MAX_WIDTH=containerWidth*1;function cleanupFitty(instances){instances?.forEach(instance=>instance?.unsubscribe());}
function updateTextAndCheckHeight(){if(iterations>=MAX_ITERATIONS||currentWidth<MIN_WIDTH){return;}
function setTransformOriginToLetter(container,letter){const rows=Array.from(container.querySelectorAll('.text-row'));let totalOffsetY=0;for(const row of rows){if(row.textContent.includes('Ð²Ð¿ÐµÑ‡Ð°Ñ‚Ð»ÐµÐ½Ð¸Ð¹')){const letterIndex=row.textContent.indexOf(letter);if(letterIndex===-1){totalOffsetY+=row.getBoundingClientRect().height;continue;}
const range=document.createRange();const textNode=row.firstChild;range.setStart(textNode,letterIndex);range.setEnd(textNode,letterIndex+1);const rect=range.getBoundingClientRect();const parentRect=container.parentElement.getBoundingClientRect();const originX=rect.left-parentRect.left+(rect.width/2);const originY=rect.top-parentRect.top+(rect.height/2);container.parentElement.style.transformOrigin=`${originX}px ${originY}px`;break;}
totalOffsetY+=row.getBoundingClientRect().height;}}
cleanupFitty(fittedRows);fittedRows=rows.map((row,index)=>{return fitty(row);});requestAnimationFrame(()=>{const totalHeight=rows.reduce((sum,row)=>sum+row.scrollHeight,0);if(totalHeight>containerHeight){const scaleFactor=Math.max(0.6,containerHeight/totalHeight);currentWidth*=scaleFactor;currentWidth=Math.max(currentWidth,MIN_WIDTH);}else if(totalHeight<containerHeight*0.9){const scaleFactor=Math.min(1.4,(containerHeight*0.95)/totalHeight);currentWidth=Math.min(currentWidth*scaleFactor,MAX_WIDTH);}
if(Math.abs(currentWidth-lastWidth)>1){container.style.width=`${currentWidth}px`;lastWidth=currentWidth;iterations++;updateTextAndCheckHeight();}else if(containerSelector.includes("fourth-slide")){setTransformOriginToLetter(container,"Ñ‚");}});}
let beforeWidth=containerWidth;updateTextAndCheckHeight();requestAnimationFrame(()=>{setTimeout(()=>{let afterWidth=container.offsetWidth;},300)});}
function calcTextRows(){resizeTimeout=setTimeout(()=>{requestAnimationFrame(()=>{(async()=>{setTimeout(()=>fitTextToContainer('.text-column.second-slide'),100);setTimeout(()=>fitTextToContainer('.text-column.third-slide'),200);setTimeout(()=>fitTextToContainer('.text-column.fourth-slide'),300);setTimeout(()=>fitTextToContainer('.text-column.main-page'),400);})();});},100);return resizeTimeout;}
async function initLazyLoad(){return new Promise((resolve,reject)=>{const lazyLoad=new LazyLoad({elements_selector:".lazy-main",use_native:true,callback_enter:(element)=>{if(element.tagName==='VIDEO'){handleVideoLoad(element);}}});resolve(lazyLoad);});}
async function enableMainPage(){return new Promise((resolve,reject)=>{document.body.style.display='block';document.body.style.overflow='auto';resolve();});}
async function showMainPage(){return new Promise((resolve,reject)=>{const mainPage=document.querySelector(".main-page");document.body.style.backgroundColor="var(--text-light-color-hover)";adjustVimeoSize();if(mainPage){mainPage.style.display='block';}
resolve();});}
function adjustVimeoSize(){const container=document.querySelector(".video-banner");const poster=document.querySelector(".video-banner .video-banner-poster");const iframe=container.querySelector("iframe");const player=new Vimeo.Player(iframe);console.log("adjustVimeoSize call");function resizeVideo(){player.getVideoWidth().then(videoWidth=>{return player.getVideoHeight().then(videoHeight=>{const containerWidth=container.offsetWidth;const containerHeight=container.offsetHeight;const containerAspectRatio=containerWidth/containerHeight;const videoAspectRatio=videoWidth/videoHeight;if(containerAspectRatio>videoAspectRatio){iframe.style.width="100%";iframe.style.height=`${containerWidth / videoAspectRatio}px`;}else{iframe.style.width=`${containerHeight * videoAspectRatio}px`;iframe.style.height="100%";}
iframe.style.top="50%";iframe.style.left="50%";iframe.style.transform="translate(-50%, -50%)";});});}
player.on("loaded",()=>{resizeVideo();});player.on("play",()=>{iframe.style.opacity="1";poster.style.display="none";});window.addEventListener("resize",resizeVideo);}
document.addEventListener('DOMContentLoaded',()=>{if(!startTime){startTime=performance.now();}
loadInto();const navbar=document.getElementById("mainNavbar");const videoBanner=document.querySelector(".video-banner");const toggler=document.querySelector('.navbar-toggler');const navbarmenu=document.querySelector('.navbar-collapse');const navbarCollapse=document.getElementById('navbarToggler');const roundButton=document.getElementById('round-center-button');window.addEventListener('scroll',updateScrolledGradient);window.addEventListener('scroll',closeMenu);if(navbarCollapse){navbarCollapse.addEventListener('show.bs.collapse',hideRoundButton);navbarCollapse.addEventListener('hide.bs.collapse',showRoundButton);}
function updateScrolledGradient(){const videoBannerHeight=videoBanner?videoBanner.offsetHeight:50;if(navbar){if(window.scrollY>videoBannerHeight){navbar.classList.add("scrolled");}else{navbar.classList.remove("scrolled");navbarCollapse.classList.remove("show");}}}
function showRoundButton(){roundButton.classList.add('show');roundButton.classList.remove('hide');}
function hideRoundButton(){roundButton.classList.remove('show');roundButton.classList.add('hide');}
function closeMenu(){if(navbarmenu){navbarmenu.classList.remove('show');}
toggler.setAttribute('aria-expanded','false');}
const navLinks=document.querySelectorAll('#country-tabs .nav-link');const cards=document.querySelectorAll('.card-column[data-country]');const offersSection=document.getElementById("offers");function getSelectedCoutry(){const activeNavLink=document.querySelector('#country-tabs .nav-link.active');if(activeNavLink){return activeNavLink.dataset.country;}
return null;}
function activateTabByHash(hash){const country=decodeURIComponent(hash.replace("#",""));console.log("ÐÐºÑ‚Ð¸Ð²Ð¸Ñ€ÑƒÐµÐ¼ Ñ‚Ð°Ð±:",country);const targetTab=[...navLinks].find(link=>{return new URL(link.href).hash.replace("#","")===country;});if(targetTab){targetTab.click();}}
function filterOffersByCountry(countryName){cards.forEach(card=>{if(card.dataset.country===countryName){card.classList.add("show");}
else{card.classList.remove("show");}});}
function isElementInViewport(el){const rect=el.getBoundingClientRect();return(rect.top<window.innerHeight&&rect.bottom>0);}
navLinks.forEach(link=>{link.addEventListener('click',(e)=>{e.preventDefault();navLinks.forEach(nav=>nav.classList.remove('active'));link.classList.add('active');filterOffersByCountry(getSelectedCoutry());const country=link.getAttribute("href").replace("#","");history.pushState(null,null,`#${encodeURIComponent(country)}`);setTimeout(()=>{if(!isElementInViewport(offersSection)){offersSection.scrollIntoView({behavior:"smooth",block:"start"});}},100);});});filterOffersByCountry(getSelectedCoutry());if(window.location.hash){const hashCountry=decodeURIComponent(window.location.hash.substring(1));activateTabByHash(hashCountry);}
window.addEventListener('popstate',function(event){if(window.location.hash){activateTabByHash(window.location.hash);}});const messageInput=document.getElementById("message-text");const messengerButtons=document.querySelectorAll("button[data-messenger]");const sendMsgModal=document.getElementById('messageModal');function updateButtonState(){const isMessageEmpty=messageInput.value.trim()==="";messengerButtons.forEach(button=>button.disabled=isMessageEmpty);}
function autoResize(event){setTimeout(()=>{const textarea=event?event.target:messageInput;textarea.style.height='auto';textarea.style.height=textarea.scrollHeight+'px';console.log("textarea.style.height =",textarea.style.height);},300);}
messageInput.addEventListener('input',autoResize);messageInput.addEventListener("input",updateButtonState);messengerButtons.forEach(button=>{button.addEventListener("click",function(){const messenger=this.dataset.messenger;const message=encodeURIComponent(messageInput.value.trim());let link="";if(messenger==="wa"){link=`https://wa.me/79219157157?text=${message}`;}else if(messenger==="tg"){link=`https://t.me/bolkoff?&text=${message}`;}
if(link){let modal=bootstrap.Modal.getInstance(sendMsgModal);if(modal)modal.hide();window.open(link,"_blank");}});});updateButtonState();if(sendMsgModal){sendMsgModal.addEventListener('show.bs.modal',event=>{const button=event.relatedTarget
const message=button.getAttribute('data-bs-message')
const messageInput=sendMsgModal.querySelector('#message-text')
messageInput.value=message;updateButtonState();autoResize();});}});const scrollLeft=document.getElementById('scrollLeft');const scrollRight=document.getElementById('scrollRight');const wrapper=document.getElementById('inspirationGallery');if(scrollLeft&&scrollRight){function updateButtonVisibility(){scrollLeft.disabled=wrapper.scrollLeft===0;scrollRight.disabled=wrapper.scrollLeft+wrapper.offsetWidth>=wrapper.scrollWidth;}
scrollLeft.addEventListener('click',()=>{const elementWidth=getVisibleElementWidth(wrapper,'left');wrapper.scrollBy({left:-elementWidth,behavior:'smooth'});setTimeout(updateButtonVisibility,300);});scrollRight.addEventListener('click',()=>{const elementWidth=getVisibleElementWidth(wrapper,'right');wrapper.scrollBy({left:elementWidth,behavior:'smooth'});setTimeout(updateButtonVisibility,300);});window.addEventListener('resize',updateButtonVisibility);wrapper.addEventListener('scroll',updateButtonVisibility);updateButtonVisibility();function getVisibleElementWidth(wrapper,direction){const children=wrapper.children;const wrapperRect=wrapper.getBoundingClientRect();for(let i=0;i<children.length;i++){const child=children[i];const childRect=child.getBoundingClientRect();if(direction==='left'&&childRect.right>wrapperRect.left){return Math.min(childRect.right-wrapperRect.left,child.offsetWidth);}
if(direction==='right'&&childRect.left<wrapperRect.right){return Math.min(wrapperRect.right-childRect.left,child.offsetWidth);}}
return 300;}}