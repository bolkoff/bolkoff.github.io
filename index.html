<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Arimo:wght@500&family=Oswald&family=Roboto+Condensed:wght@100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/glitch.css">
    <link rel="stylesheet" href="/css/style.css">
    
    <title>Element Travel</title>
</head><body>
    <svg style="display:none" fill="none">
        <symbol id="tg" viewBox="0 0 24 24">
            <g>
                  <circle cx="12" cy="12" r="9.3" stroke="currentColor" stroke-width="1.5" fill="none"/>
                  <path d="M16.8 6.2a.6.6 0 0 0-.4-.2h-.3L5.4 10.8l-.2.1a.9.9 0 0 0-.2.4v.5l.2.2.1.2h.3l2.8.7v4s0 .2.2.3a.7.7 0 0 0 .5.4c.2 0 .4 0 .5-.2l1.7-1.9 2.4 2.4.4.2h.3l.3-.3.1-.3L17 6.9v-.4l-.2-.3ZM5.5 11.4v-.2h.1l9.7-4.3-6.7 5.4-3-.7-.1-.2ZM9.3 17H9l-.1-.2v-3.6l2 2L9.3 17Zm7.2-10-2.1 10.4v.1H14l-5-4.8 7.5-6v.2Z" fill="currentColor"/>
                  <path d="M16.4 6h-.3L5.4 10.8l-.2.1a.9.9 0 0 0-.2.4v.5l.2.2.1.2h.3l2.8.7v4s0 .2.2.3a.7.7 0 0 0 .5.4c.2 0 .4 0 .5-.2l1.7-1.9 2.4 2.4.4.2h.3l.3-.3.1-.3L17 6.9v-.4l-.2-.3a.6.6 0 0 0-.4-.2Zm-11 5.3.2-.2L15.3 7l-6.7 5.4-3-.7-.1-.2v-.2ZM9.3 17H9v-.1l-.1-.2v-3.6l2 2-1.6 1.8h-.1Zm5.2.3v.1H14l-5-4.8 7.5-6v.2l-2.1 10.5Z" fill="currentColor"/>
                </g>
            
        </symbol>
      </svg>

      <svg style="display:none">
        <symbol id="wa" viewBox="0 0 24 24">
                <g>
                    <path d="M22 11.74c0 5.38-4.4 9.74-9.83 9.74a9.88 9.88 0 0 1-4.74-1.21L2 22l1.77-5.23a9.6 9.6 0 0 1-1.41-5.03A9.78 9.78 0 0 1 12.18 2 9.78 9.78 0 0 1 22 11.74Zm-9.83-8.19a8.23 8.23 0 0 0-8.25 8.19 8.1 8.1 0 0 0 1.58 4.8l-1.04 3.04 3.18-1.01a8.23 8.23 0 0 0 12.79-6.83c0-4.52-3.7-8.19-8.26-8.19Zm4.97 10.43c-.07-.1-.23-.16-.47-.28-.24-.12-1.42-.69-1.64-.77-.22-.08-.38-.12-.54.12-.16.24-.62.77-.76.93-.15.16-.29.18-.53.07-.24-.13-1.01-.38-1.93-1.19a7 7 0 0 1-1.34-1.65c-.14-.24-.02-.37.1-.49.11-.11.24-.28.36-.42.12-.14.16-.24.25-.4.07-.16.03-.29-.02-.42-.07-.12-.55-1.29-.75-1.77-.2-.47-.4-.4-.54-.4l-.46-.02a.88.88 0 0 0-.64.3c-.22.24-.84.82-.84 1.99 0 1.18.86 2.31.98 2.47.12.16 1.66 2.65 4.11 3.61 2.45.95 2.45.64 2.89.59.44-.04 1.43-.57 1.63-1.13.19-.56.19-1.04.14-1.14Z" fill="currentColor"/>
                </g>
        </symbol>
      </svg>

      <svg style="display:none">
        <symbol id="phone" viewBox="0 0 24 24">
            <g>
                <path d="m15.16 14.26-.41.43s-.96 1.01-3.59-1.76C8.54 10.17 9.5 9.16 9.5 9.16l.25-.27c.63-.66.69-1.73.14-2.5L8.77 4.8c-.68-.96-1.99-1.08-2.76-.26L4.61 6c-.39.41-.64.94-.61 1.52.08 1.49.72 4.71 4.28 8.45 3.77 3.98 7.31 4.14 8.76 3.99.46-.04.86-.29 1.18-.63L19.48 18a2 2 0 0 0-.48-3.06l-1.7-.98a1.73 1.73 0 0 0-2.14.3Z" fill="currentColor"/>
            </g>
        </symbol>
      </svg><div class="slide-container zero-slide">
    <object type="image/svg+xml" data="images/animated_logo.svg" class="logo position-absolute top-50 start-50 translate-middle">
        Анимированное лого Элемент Тревел
    </object>
</div><div class="slide-container first-slide">
    <div class="start-photo glitch"style="background-image: image-set(
        url('images/not_travel_agency.avif') 1x, 
        url('images/not_travel_agency.webp') 1x, 
        url('images/not_travel_agency.jpeg') 1x 
    );">
        <div class="channel r"></div>
        <div class="channel g"></div>
        <div class="channel b"></div>
    </div>
    <button class="btn-skip" id="skipIntro">
		<i class="bi bi-skip-forward"></i>
    </button>
</div><div class="slide-container second-slide">
    <div class="text-column second-slide">
        <div class="text-row">ЭТО</div>
        <div class="text-row">НЕ</div>
        <div class="text-row">Туристическое</div>
        <div class="text-row">Агенство</div>
    </div>
    <button class="btn-skip" id="skipIntro">
		<i class="bi bi-skip-forward"></i>
    </button>
</div>
</body><script src="https://cdnjs.cloudflare.com/ajax/libs/fitty/2.3.2/fitty.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload@19.1.3/dist/lazyload.min.js"></script>
<script>
    function fitTextToContainer(containerSelector) {
        const container = document.querySelector(containerSelector);
        if (container == null) {
            return;
        }
        const rows = Array.from(container.children);
        const containerWidth = container.offsetWidth;
        const containerHeight = container.offsetHeight;
        let currentWidth = containerWidth;
        let lastWidth = currentWidth;
        let iterations = 0;
        let fittedRows = null;
        const MAX_ITERATIONS = 10;
        const MIN_WIDTH = 100;
        const MAX_WIDTH = containerWidth * 1; // Уменьшили максимальную ширину
        
        function cleanupFitty(instances) {
          instances?.forEach(instance => instance?.unsubscribe());
        }
      
        function updateTextAndCheckHeight() {
          if (iterations >= MAX_ITERATIONS || currentWidth < MIN_WIDTH) {
            return;
          }
      
          cleanupFitty(fittedRows);
          fittedRows = rows.map((row, index) => {
            return fitty(row);
          });
          requestAnimationFrame(() => {
            const totalHeight = rows.reduce((sum, row) => sum + row.scrollHeight, 0);
            
            if (totalHeight > containerHeight) {
              // Более плавное уменьшение
              const scaleFactor = Math.max(0.6, containerHeight / totalHeight);
              currentWidth *= scaleFactor;
              currentWidth = Math.max(currentWidth, MIN_WIDTH);
            } else if (totalHeight < containerHeight * 0.9) {
              // Более осторожное увеличение
              const scaleFactor = Math.min(1.4, (containerHeight * 0.95) / totalHeight);
              currentWidth = Math.min(currentWidth * scaleFactor, MAX_WIDTH);
            } 
      
            if (Math.abs(currentWidth - lastWidth) > 1) {
              container.style.width = `${currentWidth}px`;
              //rows.forEach((row, i, rows) => row.style.width += `${currentWidth}px`);
              lastWidth = currentWidth;
              iterations++;
              updateTextAndCheckHeight();
            } else if (containerSelector.includes("fourth-slide")){
              setTransformOriginToLetter(container, "т");
            }
          });
        }
        let beforeWidth = containerWidth;
        updateTextAndCheckHeight();
        requestAnimationFrame(() => { setTimeout(() => {
                let afterWidth = container.offsetWidth;
            }, 300)
        })
      }
    
      function setTransformOriginToLetter(container, letter) {
        const firstRow = container.querySelector('.text-row');
        if (!firstRow) return;
    
        const letterIndex = firstRow.textContent.indexOf(letter);
        if (letterIndex === -1) {
            return;
        }
    
        const range = document.createRange();
        const textNode = firstRow.firstChild;
        range.setStart(textNode, letterIndex);
        range.setEnd(textNode, letterIndex + 1);
    
        const rect = range.getBoundingClientRect();
        
        // Вычисляем координаты относительно родителя
        const originX = rect.left + rect.width/2;
        const originY = 0 + rect.height/2;
    
        // Устанавливаем transform-origin
        container.parentElement.style.transformOrigin = `${originX}px ${originY}px`;
    }

    let resizeTimeout;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimeout);
        resizeTimeout = setTimeout(() => {
            requestAnimationFrame(() => {
                //fitTextToContainer('.text-column.second-slide');
                setTimeout(() => fitTextToContainer('.text-column.second-slide'), 300);
                setTimeout(() => fitTextToContainer('.text-column.third-slide'), 400);
                setTimeout(() => fitTextToContainer('.text-column.fourth-slide'), 500);
                setTimeout(() => fitTextToContainer('.text-column.main-page'), 600);
            });
        }, 100);
    });

    window.onload = function() {
        setTimeout(function() {
            window.scrollTo(0, 0);
        }, 400);
    };
    
    window.addEventListener('load', () => {
        const mainPage = document.querySelector(".main-page");
        const navbar = document.getElementById("mainNavbar");
        const videoBanner = document.querySelector(".video-banner");
        const navbarCollapse = document.getElementById('navbarToggler');
        const roundButton = document.getElementById('round-center-button');
        const toggler = document.querySelector('.navbar-toggler');
        const navbarmenu = document.querySelector('.navbar-collapse');
        const video = document.getElementById('vid');
        const introSlides = document.querySelectorAll('.slide-container:nth-child(-n + 8)');
        const skipButtons = document.querySelectorAll('.btn-skip');
        const firstVisitKey = 'siteVisits';
        const skipIntroKey = 'skipIntro';
        const MAX_SKIP_COUNT = 3; // Количество пропусков, после которых интро не показываем
        const slideshowVideo = document.getElementById("slideshow");
        const fourthslideText = document.querySelector('.fourth-slide .text-block h2 span');
        const fourthSlideTextColumn = document.querySelector('.slide-container.fourth-slide .text-column-fill')

        // Список текстов с таймингами {время в секундах: текст}
        const textTimeline = [
            { time: 0.0, text: "первого погружения с аквалангом в Красном море" },
            { time: 1.1, text: "романтического ужина на пляже Мальдив" },
            ];

        
        // Получаем количество визитов пользователя, устанавливаем 0 если ключ отсутствует
        let visitCount = localStorage.getItem(firstVisitKey) 
            ? parseInt(localStorage.getItem(firstVisitKey), 10) || 0 
            : 0;

        // Проверяем, пропустил ли пользователь интро N раз, устанавливаем 0 если ключ отсутствует
        let skipCount = localStorage.getItem(skipIntroKey) 
            ? parseInt(localStorage.getItem(skipIntroKey), 10) || 0 
            : 0;

        // Увеличиваем счетчик посещений
        visitCount++;
        localStorage.setItem(firstVisitKey, visitCount.toString());

        if (skipCount >= MAX_SKIP_COUNT) {
            // Если интро пропущено N раз, скрываем его навсегда
            console.log('hide intro');
            skipIntro();
            showMain();
        } else if (visitCount === 1) {
            // Первый визит, скрываем кнопку
            calcTextRows();
            window.scrollTo(0, 0);
            showIntroAndMainPage();
            
            skipButtons.forEach(skipButton => {
                skipButton.style.display = 'none';
            });
            
        } else {
            // Повторный визит, показываем кнопку
            calcTextRows();
            window.scrollTo(0, 0);
            //showIntroAndMainPage();

            skipButtons.forEach(skipButton => {
                skipButton.style.display = 'block';
                skipButton.addEventListener('click', () => {
                    // Увеличиваем счетчик пропусков при нажатии на кнопку
                    skipCount++;
                    localStorage.setItem(skipIntroKey, skipCount.toString());

                    skipIntro();
                    showMain();
                });
            });
        }
        
        
        // Инициализация LazyLoad
        const lazyLoadInstance = new LazyLoad({
            elements_selector: '.lazy', // Ищем все элементы с классом "lazy"
            use_native: true,
        });

        window.addEventListener('scroll', updateScrolledGradient);
        window.addEventListener('scroll', closeMenu);
        navbarCollapse.addEventListener('show.bs.collapse', hideRoundButton);
        navbarCollapse.addEventListener('hide.bs.collapse', showRoundButton);
        slideshowVideo.addEventListener("timeupdate", updateSlideshowText);
        
        function updateScrolledGradient() {
            const videoBannerHeight = videoBanner ? videoBanner.offsetHeight : 50;
            if (navbar) {
                if (window.scrollY > videoBannerHeight) {
                    navbar.classList.add("scrolled");
                } else {
                    navbar.classList.remove("scrolled");
                    navbarCollapse.classList.remove("show");
                }
            }
        }

        function showRoundButton () {
            roundButton.classList.add('show');
            roundButton.classList.remove('hide');
        }

        function hideRoundButton () {
            roundButton.classList.remove('show');
            roundButton.classList.add('hide');
        }

        function closeMenu() {
            if (navbarmenu) {
                navbarmenu.classList.remove('show');
            }
            toggler.setAttribute('aria-expanded', 'false');
        }

        function calcTextRows() {
            requestAnimationFrame(() => {
                setTimeout(() => fitTextToContainer('.text-column.second-slide'), 300);
                setTimeout(() => fitTextToContainer('.text-column.third-slide'), 400);
                setTimeout(() => fitTextToContainer('.text-column.fourth-slide'), 500);
                setTimeout(() => fitTextToContainer('.text-column.main-page'), 600);
            });
        }

        
        roundButton.addEventListener('animationstart', () => {
            video.play();
        }, { once: true });

        const slides = document.querySelectorAll("body > .slide-container");

        slides.forEach((slide) => {
            const handleAnimationEnd = (event) => {
                const animationName = event.animationName; // Получаем имя анимации, которая завершилась

                if (animationName == 'showHideSlide') {
                    slide.style.display = "none";
                    slide.removeEventListener('animationend', handleAnimationEnd);
                }

                if (animationName == 'showMainPage') {
                    document.body.style.overflow = 'auto';
                }
            };

            // Добавляем обработчик события
            slide.addEventListener('animationend', handleAnimationEnd);
        });

        
        
        function skipIntro() {
            if (introSlides) {
                introSlides.forEach(slide => {
                    slide.style.display = 'none';  // Скрываем все слайды
                    slide.style.animation = 'none !important';
                    slide.style.transition = 'none !important';
                });
            }
        }

        function showIntroAndMainPage() {
            if (introSlides) {
                introSlides.forEach(slide => {
                    slide.style.display = 'block';
                });
            }

            if (mainPage) {
                mainPage.style.display = 'block'
            }
        }

        function showMain() {
            if (mainPage) {
                mainPage.style.animation = 'none';
                mainPage.style.display = 'block'
                mainPage.offsetHeight;
                mainPage.style.animation = 
                    'showMainPage 100ms linear forwards, reduceHeightMainPage var(--main-page-delay) ease-out forwards';
            }
            
            if (navbar) {
                navbar.style.animation = 'none';
                navbar.offsetHeight;
                navbar.style.animation = 
                    'moveDownNavBar var(--main-page-delay) ease-out 1 normal forwards';
            }

            if (roundButton) {
                roundButton.style.animation = 'none';
                roundButton.offsetHeight;
                roundButton.style.animation = 
                    'fadeInButton var(--main-page-delay) ease-out 1 normal forwards';
            }

            const mainpageTextRows = mainPage.querySelectorAll(".text-row");
            mainpageTextRows.forEach(row => {
                    row.style.display = 'none';  // Скрываем все слайды
                    row.style.animation = 'none !important';
                    row.style.transition = 'none !important';
                }); 

            document.body.style.overflow = 'auto';  // Разблокируем скролл
        }

        let currentIndex = 0;

        

        function updateSlideshowText () {
            if (currentIndex < textTimeline.length && slideshowVideo.currentTime >= textTimeline[currentIndex].time) {
                // Меняем текст
                fourthslideText.textContent = textTimeline[currentIndex].text;
            
                currentIndex++;  // Переход к следующему тексту
            }
        }

        // Сброс при повторном проигрывании видео
        slideshowVideo.addEventListener("ended", () => {
            currentIndex = 0;
            //textElement.querySelector(".current-text").textContent = textTimeline[0].text;
        });

        fourthSlideTextColumn.addEventListener('animationstart', () => {
            slideshowVideo.play();
        }, { once: true });

    });
    
    const scrollLeft = document.getElementById('scrollLeft');
    const scrollRight = document.getElementById('scrollRight');
    const wrapper = document.getElementById('inspirationGallery');

    
    
    function updateButtonVisibility() {
        // Скрываем кнопки, если достигли начала или конца
        scrollLeft.disabled = wrapper.scrollLeft === 0;
        scrollRight.disabled = wrapper.scrollLeft + wrapper.offsetWidth >= wrapper.scrollWidth;
    }

    // Прокрутка влево
    scrollLeft.addEventListener('click', () => {
        const elementWidth = getVisibleElementWidth(wrapper, 'left');
        wrapper.scrollBy({ left: -elementWidth, behavior: 'smooth' });
        setTimeout(updateButtonVisibility, 300); // Учитываем анимацию
    });

    // Прокрутка вправо
    scrollRight.addEventListener('click', () => {
        const elementWidth = getVisibleElementWidth(wrapper, 'right');
        wrapper.scrollBy({ left: elementWidth, behavior: 'smooth' });
        setTimeout(updateButtonVisibility, 300); // Учитываем анимацию
    });

    // Обновляем кнопки при загрузке и изменении размера окна
    window.addEventListener('resize', updateButtonVisibility);
    wrapper.addEventListener('scroll', updateButtonVisibility);
    updateButtonVisibility(); // Первый вызов при загрузке

    // Функция для определения ширины частично видимого элемента
    function getVisibleElementWidth(wrapper, direction) {
        const children = wrapper.children;
        const wrapperRect = wrapper.getBoundingClientRect();

        for (let i = 0; i < children.length; i++) {
            const child = children[i];
            const childRect = child.getBoundingClientRect();

            if (direction === 'left' && childRect.right > wrapperRect.left) {
            return Math.min(childRect.right - wrapperRect.left, child.offsetWidth);
            }

            if (direction === 'right' && childRect.left < wrapperRect.right) {
            return Math.min(wrapperRect.right - childRect.left, child.offsetWidth);
            }
        }

        // Если ничего не найдено, используем фиксированное значение (например, 300px)
        return 300;
    }
    
</script></html>