<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sprite Slideshow</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        .viewport {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }

        .sprite-container {
            position: absolute;
            top: 0;
            left: 0;
            will-change: transform;
            object-position: left center;
            transform-origin: left top;
        }

        #sprite {
            display: block;
            width: 100%;
            height: 100%;

        }

        .text-block {
            height: 5em;
            font-size: clamp(1rem, 3.5vw, 3rem);
            position: absolute;
            top: calc(100vh - 5em);
            top: calc(100dvh - 5em);
            width: 100vw;
            text-align: left;
            background: linear-gradient(0deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0) 100%);
            transition: background 0.5s ease;
            opacity: 1;
          }

        h2 {
            display: inline-flex;
            gap: 0.5em;
            color: white;
            margin: 0 0 0 1em;
            padding: 0;
            height: 5em;
          }
          
          h2 .rotate {
            position: relative;
            display: inline-flex;
            overflow: hidden;
            height: 5em;
            clip-path: inset(0 0 0 0);
            width: calc(90vw - 1em);
          }
          
          h2 .rotate span {
            position: absolute;
            top: 5em;
            height: 5em;
            font-size: 1.1em;
            line-height: 1em;
            font-style: italic;
            text-overflow: ellipsis;
          
            animation: rotateText var(--duration) cubic-bezier(0.4, 0, 0.2, 1) 
                       var(--delay) forwards;
          
            animation-iteration-count: 1;
            animation-direction: normal;
          
            transform-origin: center center; /* Центр вращения */
            perspective: 1000px; /* Добавляем 3D-эффект */
            backface-visibility: hidden; /* Убираем артефакты */
          }
          
          
          
          @keyframes rotateText {
            0% {
              transform: translateY(0) rotateX(0);
              opacity: 1;
            }
            30% {
              transform: translateY(-5em) rotateX(5deg);
              opacity: 0.9;
            }
            60% {
              transform: translateY(-5em) rotateX(0);
              opacity: 1;
            }
            to {
              transform: translateY(-10em) rotateX(0);
              opacity: 1;
            }
          }
    </style>
</head>
<body>
    <div class="viewport">
        <div class="sprite-container">
            <picture><source media="(min-width: 1201px)" data-srcset="images/fourth_slide_1200w@1x.avif 1x"/>
                <source media="(max-width: 200px)" data-srcset="images/fourth_slide_thumb@1x.avif 1x,images/fourth_slide_thumb@2x.avif 2x,images/fourth_slide_thumb@3x.avif 3x"/>
                <source media="(min-width: 201px) and (max-width: 576px)" data-srcset="images/fourth_slide_576w@1x.avif 1x,images/fourth_slide_576w@2x.avif 2x,images/fourth_slide_576w@3x.avif 3x"/>
                <source media="(min-width: 577px) and (max-width: 768px)" data-srcset="images/fourth_slide_768w@1x.avif 1x,images/fourth_slide_768w@2x.avif 2x"/>
                <source media="(min-width: 769px) and (max-width: 992px)" data-srcset="images/fourth_slide_992w@1x.avif 1x"/>
                <source media="(min-width: 993px) and (max-width: 1200px)" data-srcset="images/fourth_slide_1200w@1x.avif 1x"/>
                <source media="(min-width: 1201px)" data-srcset="images/fourth_slide_1200w@1x.avif 1x"/>
                <source media="(max-width: 200px)" data-srcset="images/fourth_slide_thumb@1x.webp 1x,images/fourth_slide_thumb@2x.webp 2x,images/fourth_slide_thumb@3x.webp 3x"/>
                <source media="(min-width: 201px) and (max-width: 576px)" data-srcset="images/fourth_slide_576w@1x.webp 1x,images/fourth_slide_576w@2x.webp 2x,images/fourth_slide_576w@3x.webp 3x"/>
                <source media="(min-width: 577px) and (max-width: 768px)" data-srcset="images/fourth_slide_768w@1x.webp 1x,images/fourth_slide_768w@2x.webp 2x"/>
                <source media="(min-width: 769px) and (max-width: 992px)" data-srcset="images/fourth_slide_992w@1x.webp 1x"/>
                <source media="(min-width: 993px) and (max-width: 1200px)" data-srcset="images/fourth_slide_1200w@1x.webp 1x"/>
                <source media="(min-width: 1201px)" data-srcset="images/fourth_slide_1200w@1x.avif 1x"/>
                <source media="(max-width: 200px)" data-srcset="images/fourth_slide_thumb@1x.jpeg 1x,images/fourth_slide_thumb@2x.jpeg 2x,images/fourth_slide_thumb@3x.jpeg 3x"/>
                <source media="(min-width: 201px) and (max-width: 576px)" data-srcset="images/fourth_slide_576w@1x.jpeg 1x,images/fourth_slide_576w@2x.jpeg 2x,images/fourth_slide_576w@3x.jpeg 3x"/>
                <source media="(min-width: 577px) and (max-width: 768px)" data-srcset="images/fourth_slide_768w@1x.jpeg 1x,images/fourth_slide_768w@2x.jpeg 2x"/>
                <source media="(min-width: 769px) and (max-width: 992px)" data-srcset="images/fourth_slide_992w@1x.jpeg 1x"/>
                <source media="(min-width: 993px) and (max-width: 1200px)" data-srcset="images/fourth_slide_1200w@1x.jpeg 1x"/>
                <img id="sprite" src="final.webp" alt="Slideshow">
          </picture>
            
        </div>
        <div class="text-block">
            <h2>
              от <div class="rotate"><span
                  style="--duration: 1.1s; --delay: 0.0s; --i: 0"
                >первого погружения с аквалангом в Красном море</span>
                <span
                  style="--duration: 1.1s; --delay: 1.1s; --i: 1"
                >романтического ужина на пляже Мальдив</span>
                <span
                  style="--duration: 1.1s; --delay: 2.2s; --i: 2"
                >lskfjnvjklasd wlsd cl ldkjc </span>
                </div>
            </h2>
          </div>
    </div>

    <script>
        class SpriteCover {
            constructor(spriteElement, container, frameWidth, frameHeight) {
                this.sprite = spriteElement;
                this.container = container;
                this.frameWidth = frameWidth;
                this.frameHeight = frameHeight;
                this.currentFrame = 0;
                this.totalFrames = 3; // Заменить на реальное количество
                this.scale = 1;
                this.xCenter = 0;
                this.yCenter = 0;

                this.resizeObserver = new ResizeObserver(() => this.updateSize());
                this.resizeObserver.observe(container);
                
                this.initSprite();
                this.updateSize();
            }

            initSprite() {
                // Установка исходных размеров спрайта
                this.sprite.parentElement.parentElement.style.width = `${this.frameWidth * this.totalFrames}px`;
                this.sprite.parentElement.parentElement.style.height = `${this.frameHeight}px`;
                
                
                // Начальная позиция первого кадра
                this.updateTransform();
            }

            updateSize() {
                const containerWidth = this.container.clientWidth;
                const containerHeight = this.container.clientHeight;

                if (containerWidth > containerHeight) {
                    this.scale = containerWidth / this.frameWidth;
                    if (this.frameHeight > containerHeight) {
                        this.yCenter = - this.frameHeight * (containerHeight/((containerWidth - containerHeight)/2));
                        //this.yCenter = -(this.frameHeight * this.scale - containerHeight) / 2;
                    }
                    this.xCenter = 0;
                }
                else {
                    this.scale = containerHeight / this.frameHeight;
                    if (this.frameWidth > containerWidth) {
                        this.xCenter = -(this.frameWidth * this.scale - containerWidth) / 2;
                    }
                    this.yCenter = 0;
                }

                this.sprite.parentElement.parentElement.style.transform = `scale(${this.scale})`;
                
                this.updateTransform();
            }

            updateTransform() {
                const xOffset = -this.currentFrame * this.frameWidth + this.xCenter;
                this.sprite.style.transform = `translateX(${xOffset}px) translateY(${this.yCenter}px)`;
            }

            setFrame(index) {
                this.currentFrame = index;
                this.updateTransform();
            }
        }

        // Инициализация после загрузки
        window.addEventListener('load', () => {
            const sprite = document.getElementById('sprite');
            const viewport = document.querySelector('.viewport');
            const controller = new SpriteCover(
                sprite,
                viewport,
                1024, // Ширина одного кадра
                1024  // Высота одного кадра
            );
            
            // Тестовое переключение кадров
            const textTimeline = [
                { time: 1.1, text: "первого погружения с аквалангом в Красном море" },
                { time: 1.1, text: "романтического ужина на пляже Мальдив" },
                { time: 1.1, text: "романтического ужина на пляже Мальдив" },
                ];
            let current = 0;
            setInterval(() => {
                current = (current + 1) % 3;
                controller.setFrame(current);
            }, textTimeline[current].time * 1000);
        });
    </script>
</body>
</html>